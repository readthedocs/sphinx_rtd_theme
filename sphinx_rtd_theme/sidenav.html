<nav data-toggle="wy-nav-shift" class="wy-nav-side">
  <div class="wy-side-scroll">
    <div class="wy-side-nav-search" {% if theme_style_nav_header_background %} style="background: {{theme_style_nav_header_background}}" {% endif %}>
      {% block sidebartitle %}

      {% if logo and theme_logo_only %}
        <a href="{{ pathto(master_doc) }}">
      {% else %}
        <a href="{{ pathto(master_doc) }}" class="icon icon-home" alt="{{ _("Documentation Home") }}"> {{ project }}
      {% endif %}

      {% if logo %}
        {# Not strictly valid HTML, but it's the only way to display/scale
           it properly, without weird scripting or heaps of work
        #}
        <img src="{{ pathto('_static/' + logo, 1) }}" class="logo" alt="{{ _('Logo') }}"/>
      {% endif %}
      </a>

      {% if theme_display_version %}
        {%- set nav_version = version %}
        {% if READTHEDOCS and current_version %}
          {%- set nav_version = current_version %}
        {% endif %}
        {% if nav_version %}
          <div class="version">
            {{ nav_version }}
          </div>
        {% endif %}
      {% endif %}

      {% include "searchbox.html" %}

      {% endblock %}
    </div>

    {% block navigation %}
    <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      {% block menu %}
        {#
          The singlehtml builder doesn't handle this toctree call when the
          toctree is empty. Skip building this for now.
        #}
        {% if 'singlehtml' not in builder %}
          {% set global_toc = toctree(maxdepth=theme_navigation_depth|int,
                                      collapse=theme_collapse_navigation|tobool,
                                      includehidden=theme_includehidden|tobool,
                                      titles_only=theme_titles_only|tobool) %}
        {% endif %}
        {% if global_toc %}
          {{ global_toc }}
        {% else %}
          <!-- Local TOC -->
          <div class="local-toc">{{ toc }}</div>
        {% endif %}
      {% endblock %}
    </div>
    {% endblock %}
  </div>
  {% if READTHEDOCS %}
  {# Add rst-badge after rst-versions for small badge style. #}
    <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
      <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Read the Docs</span>
        v: {{ current_version }}
        <span class="fa fa-caret-down"></span>
      </span>
      <div class="rst-other-versions">
        <dl>
          <dt>{{ _('Versions') }}</dt>
          {% for slug, url in versions %}
            <dd><a href="{{ url }}">{{ slug }}</a></dd>
          {% endfor %}
        </dl>
        <dl>
          <dt>{{ _('Downloads') }}</dt>
          {% for type, url in downloads %}
            <dd><a href="{{ url }}">{{ type }}</a></dd>
          {% endfor %}
        </dl>
        <dl>
          {# Translators: The phrase "Read the Docs" is not translated #}
          <dt>{{ _('On Read the Docs') }}</dt>
            <dd>
              <a href="//{{ PRODUCTION_DOMAIN }}/projects/{{ slug }}/?fromdocs={{ slug }}">{{ _('Project Home') }}</a>
            </dd>
            <dd>
              <a href="//{{ PRODUCTION_DOMAIN }}/builds/{{ slug }}/?fromdocs={{ slug }}">{{ _('Builds') }}</a>
            </dd>
        </dl>
      </div>
    </div>
  {% endif %}
</nav>
